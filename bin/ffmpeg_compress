#!/bin/bash

# Compress video length and width by scale factor and crf (constant rate factor)
if [[ $# -eq 0 || $1 = "--help" ]]; then
  echo "Usage: ffmpeg_compress SRC_VIDEO SCALE_FACTOR CRF OUTPUT_VIDEO"
  echo "    Recommended SCALE_FACTOR is 3 and CRF is 28"
  exit 1
fi

echo "Compressing video '$1' by a scale factor of $2 and a crf of $3 to '$4'"
echo "Recommended scale factor is 3 and crf is 28"
read -p "Would you like output to be silenced? [y/N]: " silence
case $silence in
  y|Y) ffmpeg -i "$1" -strict -2 -vf "scale=iw/$2:ih/$2" -vcodec libx265 \
    -crf $3 -loglevel 24 "$4" ;;
  *) ffmpeg -i "$1" -strict -2 -vf "scale=iw/$2:ih/$2" -vcodec libx265 \
    -crf $3 "$4" ;;
esac
